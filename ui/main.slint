import { Button, VerticalBox, HorizontalBox, LineEdit, ScrollView } from "std-widgets.slint";

// 1. KOMPONENTA TLAƒå√çTKA
component MenuButton inherits Rectangle {
    in-out property<string> text;
    in-out property<bool> active;
    callback clicked;
    height: 45px;
    background: active ? #2CC985 : touch.has-hover ? #3d3d3d : #2e2e2e;
    border-radius: 6px;
    border-width: 1px;
    border-color: active ? #2CC985 : #3f3f3f;
    touch := TouchArea { clicked => { root.clicked(); } }
    HorizontalLayout {
        padding-left: 20px;
        Text {
            text: root.text; color: root.active ? #1A1A1A : white;
            vertical-alignment: center; font-size: 14px; font-weight: root.active ? 800 : 500;
        }
    }
}

// 2. NOV√â SAMOSTATN√â OKNO PROGRESS BARU
export component ProgressWindow inherits Window {
    in-out property <float> progress: 0.0;
    in-out property <string> status: "P≈ôipravuji...";
    
    title: "Import Dat";
    width: 400px;
    height: 180px;
    background: #212121;
    always-on-top: true; // Z≈Østane v≈ædy nad hlavn√≠m oknem
    no-frame: false;     // M√° r√°m (k≈ô√≠≈æek atd.), pro modernƒõj≈°√≠ vzhled lze d√°t true (ale pak nejde posouvat)

    VerticalLayout {
        padding: 30px; spacing: 20px; alignment: center;
        
        Text { 
            text: root.status; 
            color: white; font-size: 18px; font-weight: 700; horizontal-alignment: center; 
        }

        // Progress Bar
        Rectangle {
            width: 300px; height: 12px; background: #333; border-radius: 6px;
            Rectangle {
                width: root.progress * 300px; height: 12px; 
                background: #2CC985; border-radius: 6px; x: 0;
                animate width { duration: 100ms; }
            }
        }

        Text { 
            text: round(root.progress * 100) + "%"; 
            color: #888; horizontal-alignment: center; 
        }
    }
}

// 3. HLAVN√ç OKNO APLIKACE (Bez progress logiky)
export component AppWindow inherits Window {
    in-out property <string> verze_aplikace: "0.3.0";
    in-out property <string> cesta_archiv: "";
    in-out property <string> cesta_vyroba: "";
    in-out property <string> posledni_sync_cas: "Nikdy";
    in-out property <bool> databaze_ok: false;
    in-out property <string> stav_text: "DATAB√ÅZE NEN√ç NAƒåTENA";

    property <int> vybrana_stranka: 0; 
    property <int> settings_tab: 0;

    callback vybrat_archiv();
    callback vybrat_vyrobu();
    callback ulozit_nastaveni();
    callback spustit_synchronizaci(); // Rust toto zavol√° a otev≈ôe druh√© okno

    title: "MRB Obchodn√≠k - v" + verze_aplikace;
    min-width: 900px; min-height: 650px;
    background: #1A1A1A;

    HorizontalLayout {
        padding: 0; spacing: 0;

        // LEV√ù PANEL
        Rectangle {
            width: 280px; background: #212121;
            VerticalLayout {
                padding: 25px; spacing: 10px;
                Text { text: "MRB Obchodn√≠k"; color: #2CC985; font-size: 20px; font-weight: 900; horizontal-alignment: center; }
                Rectangle { height: 20px; }
                MenuButton { text: "üè†  Domovsk√° obrazovka"; active: vybrana_stranka == 0; clicked => { vybrana_stranka = 0; } }
                MenuButton { text: "üìÇ  Nov√Ω import"; active: vybrana_stranka == 1; clicked => { vybrana_stranka = 1; } }
                MenuButton { text: "‚öô  Nastaven√≠ syst√©mu"; active: vybrana_stranka == 2; clicked => { vybrana_stranka = 2; } }
                Rectangle { vertical-stretch: 1; }
                Text { text: "v" + root.verze_aplikace; color: #555; font-size: 11px; horizontal-alignment: center; }
            }
        }

        // PRAV√ù OBSAH
        Rectangle {
            background: #1A1A1A;
            
            if (vybrana_stranka == 0) : VerticalBox {
                alignment: center; spacing: 20px;
                Text { text: "üè†"; font-size: 60px; horizontal-alignment: center; }
                Text { text: "V√≠tejte v syst√©mu"; font-size: 30px; font-weight: 800; color: white; horizontal-alignment: center; }
            }

            if (vybrana_stranka == 1) : VerticalBox {
                alignment: center;
                Text { text: "üöß"; font-size: 60px; horizontal-alignment: center; }
                Text { text: "Sekce Import"; font-size: 24px; color: white; horizontal-alignment: center; }
            }

            if (vybrana_stranka == 2) : VerticalLayout {
                padding: 40px; spacing: 20px;
                HorizontalBox {
                    height: 45px; spacing: 10px; padding: 0;
                    Button { text: "Cesty"; primary: settings_tab == 0; clicked => { settings_tab = 0; } }
                    Button { text: "Synchronizace"; primary: settings_tab == 1; clicked => { settings_tab = 1; } }
                    Button { text: "Spr√°vce dat"; primary: settings_tab == 2; clicked => { settings_tab = 2; } }
                }

                Rectangle {
                    vertical-stretch: 1;
                    
                    if (settings_tab == 0) : VerticalLayout {
                        vertical-stretch: 1; alignment: start; spacing: 20px;
                        VerticalBox {
                            spacing: 5px; padding: 0;
                            Text { text: "CESTA K ARCHIVU"; color: #888; font-size: 11px; font-weight: 700; }
                            HorizontalLayout {
                                spacing: 10px; height: 40px;
                                LineEdit { text: cesta_archiv; placeholder-text: "Vyberte slo≈æku..."; height: 40px; }
                                Button { text: "Proch√°zet"; width: 100px; clicked => { root.vybrat_archiv(); } }
                            }
                        }
                        VerticalBox {
                            spacing: 5px; padding: 0;
                            Text { text: "CESTA PRO V√ùROBU"; color: #888; font-size: 11px; font-weight: 700; }
                            HorizontalLayout {
                                spacing: 10px; height: 40px;
                                LineEdit { text: cesta_vyroba; placeholder-text: "Vyberte slo≈æku..."; height: 40px; }
                                Button { text: "Proch√°zet"; width: 100px; clicked => { root.vybrat_vyrobu(); } }
                            }
                        }
                        Rectangle { vertical-stretch: 1; }
                        Button { text: "ULO≈ΩIT KONFIGURACI"; height: 50px; primary: true; clicked => { root.ulozit_nastaveni(); } }
                    }

                    if (settings_tab == 1) : VerticalLayout {
                        vertical-stretch: 1; spacing: 25px;
                        Text { text: "Synchronizace partner≈Ø"; font-size: 22px; font-weight: 700; color: white; horizontal-alignment: center; }
                        Rectangle {
                            border-color: databaze_ok ? #2CC985 : #e74c3c; border-width: 2px; border-radius: 10px; height: 100px;
                            Text { text: root.stav_text; color: databaze_ok ? #2CC985 : #e74c3c; font-size: 20px; font-weight: 800; horizontal-alignment: center; vertical-alignment: center; }
                        }
                        VerticalLayout {
                            spacing: 5px;
                            Text { text: "Posledn√≠ aktualizace probƒõhla:"; color: #888; font-size: 14px; horizontal-alignment: center; }
                            Text { text: root.posledni_sync_cas; color: white; font-size: 20px; font-weight: 600; horizontal-alignment: center; }
                        }
                        Rectangle { vertical-stretch: 1; }
                        Button { text: "NAHR√ÅT EXCEL A SPUSTIT"; height: 50px; primary: true; clicked => { root.spustit_synchronizaci(); } }
                    }

                    if (settings_tab == 2) : VerticalLayout {
                        vertical-stretch: 1;
                        Text { text: "Zde bude seznam obchodn√≠ch partner≈Ø..."; color: gray; }
                        Rectangle { vertical-stretch: 1; }
                    }
                }
            }
        }
    }
}